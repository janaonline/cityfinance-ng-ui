<div class="row" *ngIf="isProcessed && reportKeys.length == 0"></div>

<div class="row" *ngIf="isProcessed && reportKeys.length > 0">
  <div
    style="background: #333; color: white; display: block; padding: 1%; max-width: 98%;position: relative;"
  >
    <img class="align-center" src="/assets/images/cityfinance-logo.png" />
    <br />

    <form
      [formGroup]="currenyConversionForm"
      style="width: 14%; display: inline-block; position: absolute; right: 1%; bottom: 9%;"
    >
      <angular2-multiselect
        formControlName="type"
        *ngIf="currencyConversionList && currencyConversionList.length"
        [data]="currencyConversionList"
        [settings]="conversionDropdownConfig"
        (onSelect)="onSelectingConversionType($event)"
        (onDeSelect)="onSelectingConversionType(null)"
        (onDeSelectAll)="onSelectingConversionType(null)"
      >
      </angular2-multiselect>
    </form>
    <p class="text-center">{{ reportReq.type }} {{ reportReq.reportGroup }}</p>
    <span
      *ngIf="currencyTypeInUser"
      style="color: white; position: absolute; bottom: 1%; left: 1%; font-style: italic;"
      id="currencyWarning"
    >
      <!-- Do not change the id of above span. we fetch this text dynamically from html using this id.-->
      <span style="color: red;">*</span> The following data is in
      {{ (currenyConversionForm?.value?.type)[0].name }} format. There could be
      some rounding off differences.
    </span>
  </div>
  <div
    class="col-md-12"
    style="max-width: 98%; overflow: auto; padding: 0px; border-right: 1px solid #e2e2e2"
  >
    <table class="table-bordered">
      <thead>
        <tr></tr>

        <!-- Years -->
        <tr *ngIf="reportReq.years.length > 0">
          <th
            class="text-center yearssss"
            colspan="2"
            style="position: sticky; left: 0px; background: white; width: 30vw;"
          >
            Year(s)
          </th>
          <th
            class="text-center yyy"
            [attr.colspan]="headerGroup.yearColspan"
            *ngFor="let yr of reportReq.years"
          >
            {{ yr }}
          </th>
        </tr>

        <!-- Headers-->
        <tr>
          <th
            class="text-center"
            [attr.rowspan]="headerGroup.accRowspan"
            style="position: sticky; left: 0px; background: white;"
          >
            Account Code
          </th>
          <th
            class="text-center"
            [attr.rowspan]="headerGroup.accRowspan"
            style="position: sticky; left: 103px; background: white; border-right: inherit solid #868686;"
          >
            Major Group/Minor Group
          </th>
          <th class="text-center" *ngFor="let yr of years">{{ yr.state }}</th>
          <!-- <th colspan="20" ></th> -->
        </tr>

        <tr>
          <!-- <th class="text-center">Account Code</th>
          <th class="text-center">Major Group/Minor Group</th> -->
          <th class="text-center" *ngFor="let yr of years">{{ yr.caption }}</th>
        </tr>
      </thead>

      <tbody>
        <tr
          *ngFor="let key of reportKeys"
          [ngClass]="{
            bold: report[key] && report[key].isBold,
            hidden: !report[key]
          }"
        >
          <!-- <td>{{report[key] | json}}</td> -->
          <td
            class="text-center sticky"
            style="position: sticky; left: 0px;background: white;"
          >
            {{ report[key] ? report[key].code : "" }}
          </td>
          <td
            style="position: sticky; left:103px;border-right: inherit solid #868686; "
            [ngClass]="{
              'text-right':
                (report[key] && report[key].line_item.includes('Total')) ||
                (report[key] && report[key].line_item.includes('Net')) ||
                (report[key] && report[key].line_item.includes('Gross')) ||
                (report[key] &&
                  report[key].line_item.includes('Net Surplus')) ||
                (report[key] &&
                  report[key].line_item.includes('Surplus/(Deficit) (C) (A-B)'))
            }"
          >
            {{ report[key] ? report[key].line_item : "" }}
          </td>
          <td class="text-right" *ngFor="let yr of years">
            <span *ngIf="report[key]">
              <span
                *ngIf="
                  currencyTypeInUser &&
                  (report[key][yr.title] || report[key][yr.title] === 0) &&
                  report[key].line_item != 'A.Income' &&
                  report[key].line_item != 'B.Expenditure' &&
                  report[key].line_item != 'A. Liabilities' &&
                  report[key].line_item != 'I. Reserves & Surplus' &&
                  report[key].line_item !=
                    'II. Grants , Contribution for specific purposes' &&
                  report[key].line_item != 'III. Loans' &&
                  report[key].line_item !=
                    'IV. Current Liabilities and Provisions' &&
                  report[key].line_item != 'B. Assets' &&
                  report[key].line_item !=
                    'III. Current Assets, Loans and Advances' &&
                  report[key].line_item != 'IV. Other Assets' &&
                  report[key].line_item !=
                    'IV. Current Liabilities and Provisions'
                "
                [matTooltip]="
                  'INR ' +
                  (report[key][yr.title]
                    | inrCurrency: { currencyTypeInUser: null })
                "
              >
                {{
                  report[key][yr.title]
                    | inrCurrency: { currencyTypeInUser: currencyTypeInUser }
                }}
              </span>

              <span
                *ngIf="
                  !currencyTypeInUser &&
                  (report[key][yr.title] || report[key][yr.title] === 0) &&
                  report[key].line_item != 'A.Income' &&
                  report[key].line_item != 'B.Expenditure' &&
                  report[key].line_item != 'A. Liabilities' &&
                  report[key].line_item != 'I. Reserves & Surplus' &&
                  report[key].line_item !=
                    'II. Grants , Contribution for specific purposes' &&
                  report[key].line_item != 'III. Loans' &&
                  report[key].line_item !=
                    'IV. Current Liabilities and Provisions' &&
                  report[key].line_item != 'B. Assets' &&
                  report[key].line_item !=
                    'III. Current Assets, Loans and Advances' &&
                  report[key].line_item != 'IV. Other Assets' &&
                  report[key].line_item !=
                    'IV. Current Liabilities and Provisions'
                "
              >
                {{
                  report[key][yr.title]
                    | inrCurrency: { currencyTypeInUser: null }
                }}
              </span>

              <span
                *ngIf="
                  (report[key][yr.title] === undefined ||
                    report[key][yr.title] === null) &&
                  report[key]['code']
                "
              >
                <span
                  *ngIf="
                    ((report[key] && report[key][yr.title] === undefined) ||
                      (report[key] && report[key][yr.title] === null)) &&
                    report[key]['allNullYear'] &&
                    report[key]['allNullYear'][yr.title]
                  "
                >
                  Data not available
                </span>

                <span
                  *ngIf="
                    report[key] &&
                    report[key]['allNullYear'] &&
                    !report[key]['allNullYear'][yr.title] &&
                    (report[key][yr.title] === undefined ||
                      report[key][yr.title] === null)
                  "
                >
                  0
                </span>
              </span>
              <span
                *ngIf="report[key] && report[key][yr.title] && yr.isComparative"
                >%</span
              >
            </span>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>

<br />
<div class="col-md-12">
  <button
    (click)="download()"
    *ngIf="isProcessed && reportKeys.length > 0"
    class="btn btn-primary right"
  >
    Download
  </button>
</div>
<div
  class="col-md-12"
  *ngIf="isProcessed && reportKeys.length > 0 && reportReq.isComparative"
>
  <p>
    <small
      >Percentages represent percentage of Total Expenditure in the case of
      Expenditure line items and percentage of Total Income for all other line
      items</small
    >
  </p>
</div>
<div
  class="col-md-12"
  *ngIf="
    isProcessed &&
    reportKeys.length > 0 &&
    reportReq.type.indexOf('Summary') > -1
  "
>
  <!-- <p>
    <small>
      <b>Revenue</b> : Not Tax Revenue includes Assigned Revenue and
      Compensations (120), Rental Income from Municipal Properties (130), Fees
      and User Charges (140), and Sale and Hire Charges (150). Other income
      includes Income from Investments (170), Interest Earned (171), Other
      Income (180) and Others (100).
    </small>
  </p>
  <p>
    <small>
      <b>Expenses</b> : Other Expenses include Programme Expenses (250),
      Provision & Write off (270), Miscellneous Expenses (271), Depreciation of
      Fixed Assets (272), Prior Period Items (280), Transfer to Reserve Funds
      (290) and Others (200)
    </small>
  </p> -->
</div>
