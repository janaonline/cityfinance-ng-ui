<div class="all-container">
  <div class="form-container" [ngClass]="{ 'form-on-left': shiftFormToLeft }">
    <form [formGroup]="filterForm" *ngIf="filterForm" (ngSubmit)="showData()">
      <!-- <angular2-multiselect
        formControlName="ulbList"
        [data]="NeworiginalUlbList"
        [settings]="multiSelectStates"
        (onClose)="onClosingULBSelection()"
      >
      </angular2-multiselect> -->

      <mat-form-field appearance="outline">
        <input
          #autoCompleteInput
          type="text"
          placeholder="Search ULB"
          aria-label="text"
          matInput
          [formControl]="ulbFilterControl"
          [matAutocomplete]="auto"
        />
        <i class="fa fa-search" aria-hidden="true"></i>

        <mat-autocomplete #auto="matAutocomplete" class="tesinng">
          <mat-option *ngIf="!filteredULBList" disabled>
            No ULB matched
          </mat-option>
          <div *ngIf="filteredULBList">
            <mat-optgroup
              *ngFor="let state of filteredULBList"
              [label]="state._id.name"
            >
              <mat-option
                *ngIf="!state.ulbList || !state.ulbList.length"
                disabled
              >
                No ULB available.
              </mat-option>
              <mat-option
                *ngFor="let ulb of state.ulbList"
                [value]="ulb.name"
                [title]="ulb.name"
                (click)="selectULB(ulb)"
                [disabled]="!ulb?.financialYear"
              >
                {{ ulb.name }}
                <span *ngIf="!ulb?.financialYear" style="color: #ef6e6e">
                  (No Financial Year Found)
                </span>
              </mat-option>
            </mat-optgroup>
          </div>
        </mat-autocomplete>
      </mat-form-field>

      <small>or select from list</small>

      <div class="years-container">
        <span
          class="year"
          [ngClass]="{ selected: filterForm?.controls?.years?.at(i).value }"
          *ngFor="let year of commonYears; let i = index"
          (click)="onClickingYear(i)"
        >
          {{ year }}
        </span>

        <p
          *ngIf="
            yearListUpdate &&
            !commonYears?.length &&
            filterForm?.controls.ulbs?.value?.length
          "
          class="text-center warning"
          style="width: 100%; color: red"
        >
          Selected ULBs do not have any common year with data
        </p>
      </div>

      <input
        class="btn btn-primary ng-star-inserted"
        type="submit"
        value="View Financial Statements"
        [disabled]="!commonYears || !commonYears.length"
      />

      <p
        *ngIf="formInvalidMessage"
        class="text-center"
        style="width: 100%; color: red; margin-top: 1%"
      >
        {{ formInvalidMessage }}
      </p>
    </form>

    <div class="last-container">
      <div
        class="ulb-list-container"
        *ngIf="filterForm?.value?.ulbList?.length"
        [ngStyle]="{
          'overflow-y':
            filterForm?.value?.ulbList?.length > 7 ? 'scroll' : hidden
        }"
      >
        <h5>Selected ULBs</h5>
        <div
          class="ulb"
          *ngFor="let ulb of filterForm?.value?.ulbList; let i = index"
        >
          {{ ulb.name }}

          <i
            class="fa fa-trash"
            aria-hidden="true"
            (click)="removeSelectedULBAt(i)"
          ></i>
        </div>
      </div>

      <div class="source-file-wrapper mt-2">
        <a
          style="float: right; text-decoration: underline"
          (click)="routerTo('/financial-statement/data-tracker')"
          >Download Source Files</a
        >
      </div>
    </div>
  </div>

  <div class="report-container" *ngIf="showReport">
    <form [formGroup]="filterForm">
      <div class="left">
        <span
          class="reportType"
          [ngClass]="{
            selected:
              filterForm?.controls?.reportGroup.value ===
              'Income & Expenditure Statement'
          }"
          (click)="
            updateReportGroup('Income & Expenditure Statement') ||
              (activeGroup = 'IE')
          "
          >Income & Expenditure</span
        >
        <span
          class="reportType"
          [ngClass]="{
            selected:
              filterForm?.controls?.reportGroup.value === 'Balance Sheet'
          }"
          (click)="updateReportGroup('Balance Sheet') || (activeGroup = 'BS')"
          >Balance Sheet</span
        >
      </div>
      <div style="display: inline-flex">
        <div class="right mr-2">
          <label for="" class="">Report Type </label><br />
          <label class="radio-inline">
            <input
              type="radio"
              name="type"
              formControlName="type"
              value="Summary"
              checked
            />Summary
          </label>
          <label class="radio-inline">
            <input
              type="radio"
              name="type"
              formControlName="type"
              value="Detailed"
            />Detailed
          </label>
        </div>
        <div class="right">
          <label for="" class="">Value Format </label><br />
          <label class="radio-inline">
            <input
              type="radio"
              formControlName="valueType"
              value="absolute"
              checked
            />Absolute
          </label>
          <label class="radio-inline">
            <input
              type="radio"
              formControlName="valueType"
              value="per_capita"
            />Per Capita
          </label>
        </div>
      </div>
    </form>
    <router-outlet *ngIf="showReport">
      <button class="btn btn-primary right source-file-download">
        Download
      </button>
    </router-outlet>
  </div>
</div>
