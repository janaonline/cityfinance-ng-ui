<div class="common-container">
  <div class="container">
    <div class="row">
      <div class="col-md-6">
        <h3>ULB Data Bulk Entry</h3>
      </div>
      <div class="col-md-6">
        <button [routerLink]="['../list']" class="right btn btn-primary">
          Entry List
        </button>
      </div>
    </div>
    <br />
    <span
      >Note* : Current version supports bulk data entry for single year
      only</span
    >
    <br />

    <div class="row">
      <form [formGroup]="bulkEntryForm" (ngSubmit)="upload()">
        <div class="col-md-4">
          <div class="form-group">
            <label>Financial Year</label>
            <select formControlName="year" class="form-control">
              <option *ngFor="let yr of years" [ngValue]="yr">{{ yr }}</option>
            </select>
          </div>
        </div>
        <div class="col-md-4">
          <div class="form-group">
            <label>Select files to upload</label>
            <input
              id="cin"
              name="cin"
              type="file"
              (change)="fileChangeEvent($event)"
              placeholder="Upload a file..."
              multiple
            />
          </div>
        </div>
        <div class="col-md-4">
          <div class="form-group">
            <br />
            <button type="submit" class="btn btn-primary btn-s">Upload</button>
          </div>
        </div>
      </form>
    </div>

    <div class="row">
      <div class="col-sm-10">
        <ul class="list-group" type="1">
          <li
            class="list-group-item"
            *ngFor="let file of filesToUpload; let i = index"
          >
            <div>
              <div style="width: 50%; display: inline-block;">
                <div
                  style="width: fit-content; display: inline-block; margin-right: .5em;"
                >
                  {{ i + 1 }}.
                </div>
                {{ file.name }}
              </div>

              <!-- Normal Progress bar-->
              <div
                class="progress mt-1"
                *ngIf="fileProcessingTracker[file.name]?.status != 'in-process'"
              >
                <div
                  class="progress-bar"
                  role="progressbar"
                  [ngClass]="{
                    uploadComplete:
                      fileUploadTracker[file.name] &&
                      fileUploadTracker[file.name]['percentage'] === 100
                  }"
                  [style.width.%]="
                    (fileUploadTracker[file.name] &&
                      fileUploadTracker[file.name]['percentage']) ||
                    0
                  "
                  [attr.aria-valuenow]="
                    (fileUploadTracker[file.name] &&
                      fileUploadTracker[file.name]['percentage']) ||
                    0
                  "
                  aria-valuemin="0"
                  aria-valuemax="100"
                >
                  {{
                    (fileUploadTracker[file.name] &&
                      fileUploadTracker[file.name]["percentage"]) ||
                      0
                  }}
                </div>
              </div>

              <!-- Stripped progres bar for in processing-->
              <div
                class="progress mt-1"
                *ngIf="
                  fileProcessingTracker[file.name]?.status === 'in-process'
                "
              >
                <div
                  class="progress-bar progress-bar-striped active"
                  role="progressbar"
                  aria-valuenow="75"
                  aria-valuemin="0"
                  aria-valuemax="100"
                  style="width: 100%"
                >
                  {{
                    fileProcessingTracker[file.name].message || "Processing..."
                  }}
                </div>
              </div>
            </div>
          </li>
        </ul>
      </div>
    </div>
    <br /><br />

    <div class="row" *ngIf="uploadResult">
      <table style="width: 50%">
        <tr>
          <th>Perticular</th>
          <th>status</th>
        </tr>
        <tr *ngFor="let item of uploadResult">
          <td>{{ item.msg }}</td>
          <td>{{ item.success }}</td>
        </tr>
      </table>
    </div>
  </div>
</div>
