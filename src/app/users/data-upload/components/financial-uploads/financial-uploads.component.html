<div *ngIf="isULBMillionPlus !== undefined">
  <h3 style="position: relative; text-align: center">
    <span *ngIf="loggedInUserDetails?.role !== USER_TYPE.ULB">
      ULB: {{ financialData?.ulbName }}</span
    >
    <button
      [style.position]="
        loggedInUserDetails?.role !== USER_TYPE.ULB ? 'absolute' : 'relative'
      "
      style="right: 0px; float: right; margin-right: 2.5%; outline: none"
      class="btn btn-primary btn-upload"
      (click)="showPreview()"
    >
      Preview
    </button>
  </h3>
</div>
<mat-horizontal-stepper
  *ngIf="isULBMillionPlus !== undefined"
  id="stepper"
  [ngClass]="{ 'block-steeper-top-navigation': !userHasAlreadyFilledForm }"
>
  <mat-step>
    <ng-template matStepLabel>
      <span title="Introduction">Introduction</span>
    </ng-template>
    <div style="margin-bottom: 2%">
      <h4 style="font-weight: 600" class="mb-2">
        Guidelines to Urban Local Bodies (ULBs):
      </h4>
      <ol>
        <li>
          ULBs need enter data and upload documents appropriately. Targets for
          service level indicators and required documents must be uploaded after
          taking due approval from Municipal commissioner/ Executive officer of
          ULB.
        </li>
        <li>
          Only one PDF document can be uploaded against each requirement. If
          more than one document needs to be uploaded for a requirement, you
          need to merge the file and then upload.
        </li>
        <li>
          Data validation are built in the cell where you need to enter data.
          Please enter data in required format
        </li>
        <li>Refer the resources when you have any doubt.</li>
        <li>
          ULBs can enter data and upload documents at your convenience i.e. at
          one go or in several sessions by saving it as draft.
        </li>
        <li>
          It would be easier for ULBs to put all the documents that are required
          to be entered and uploaded in a single folder before start entering or
          uploading.
        </li>
        <li>
          You need to name the documents to be uploaded in the following format
          â€œDocument Name_State Name_ULB Name.
        </li>
        <li>
          ULBs may see the preview of the data entered and documents uploaded
          before submitting it.
        </li>
        <li>
          ULBs would be able to take a print out of the data entered for their
          future reference.
        </li>
        <li>ULBs would not be able to edit the form after submitting it.</li>
      </ol>
    </div>
    <button
      style="float: right"
      class="btn btn-primary btn-upload"
      (click)="stepper.next()"
    >
      Next
    </button>
    <ng-content> </ng-content>
  </mat-step>
  <mat-step>
    <ng-template matStepLabel>
      <span title="Water Supply & Waste-Water Management"
        >Water Supply & Waste-Water Management</span
      >
    </ng-template>
    <!-- canViewActionTaken: {{ canViewActionTaken }} -->
    <app-waste-water-management
      [form]="waterWasteManagementForm"
      [canSeeApproveActionTaken]="canViewActionTaken"
      [canTakeApproveAction]="canTakeApproveRejectAction"
      [isDataPrefilled]="!!solidWasteProfilledAnswers"
      [isSubmitButtonClick]="isSubmitButtonClicked"
      [canUploadFile]="canUploadFile"
      (showNext)="stepper.next()"
      (saveAsDraft)="saveAsDraft()"
      (outputValues)="onWaterWasteManagementEmitValue($event)"
      (previous)="stepper.previous()"
    ></app-waste-water-management>
  </mat-step>
  <mat-step>
    <ng-template matStepLabel>
      <span title="Solid Waste Management">Solid Waste Management</span>
    </ng-template>

    <app-documents-upload
      *ngIf="solidWasteManagementForm"
      [ngClass]="{
        documentCompleted:
          ((financialData?.isCompleted &&
            !isULBMillionPlus &&
            !canUploadFile) ||
            (!isULBMillionPlus && !canUploadFile)) &&
          !canTakeApproveRejectAction
      }"
      [isSubmitButtonClick]="isSubmitButtonClicked"
      [userType]="USER_TYPE.ULB"
      [form]="solidWasteManagementForm"
      [documents]="solidWasteProfilledAnswers"
      [canUploadFile]="canUploadFile"
      [questions]="solidWasteQuestions"
      [canSeeApproveActionTaken]="canViewActionTaken"
      [canTakeApproveAction]="canTakeApproveRejectAction"
      (outputValues)="onSolidWasteEmit($event)"
      (showNext)="stepper.next()"
      (previous)="stepper.previous()"
      (saveAsDraft)="saveAsDraft()"
    ></app-documents-upload>
    <p>
      <span class="mandatory">**</span> Upload GAP analysis report and project
      identified for bridging the gap as a single document.
    </p>
  </mat-step>
  <mat-step label="Million Plus Cities Only" *ngIf="isULBMillionPlus">
    <ng-template matStepLabel>
      <span title="Million Plus Cities Only">Million Plus Cities Only</span>
    </ng-template>
    <app-documents-upload
      *ngIf="millionPlusCitiesForm"
      [ngClass]="{
        documentCompleted:
          ((financialData?.isCompleted && !canUploadFile) || !canUploadFile) &&
          !canTakeApproveRejectAction
      }"
      [isSubmitButtonClick]="isSubmitButtonClicked"
      [userType]="USER_TYPE.ULB"
      [form]="millionPlusCitiesForm"
      [documents]="millionPlusCitiesAnswers"
      [canUploadFile]="canUploadFile"
      [questions]="millionPlusCitiesQuestions"
      [canSeeApproveActionTaken]="canViewActionTaken"
      [canTakeApproveAction]="canTakeApproveRejectAction"
      (outputValues)="onMilionPlusCitiesEmitValue($event)"
      (showNext)="stepper.next()"
      (previous)="stepper.previous()"
      (saveAsDraft)="saveAsDraft()"
    ></app-documents-upload>
  </mat-step>

  <mat-step label="Submit" *ngIf="canUploadFile">
    <app-completed
      [submitted]="userHasAlreadyFilledForm"
      (submit)="uploadCompletedQuestionnaireData()"
      (previous)="stepper.previous()"
    >
      <button
        class="btn btn-primary"
        style="outline: none"
        style="margin-right: 2%"
        (click)="showPreview()"
      >
        Show Preview
      </button>
    </app-completed>
  </mat-step>

  <mat-step label="Submit Actions" *ngIf="canTakeApproveRejectAction">
    <app-completed
      [submitted]="userHasAlreadyFilledForm"
      (submit)="onSubmitApprovalActions()"
      (previous)="stepper.previous()"
    >
      <button
        class="btn btn-primary"
        style="outline: none"
        style="margin-right: 2%"
        (click)="showPreview()"
      >
        Show Preview
      </button>
    </app-completed>
  </mat-step>
</mat-horizontal-stepper>
<p
  class="question-instruction"
  *ngIf="
    isULBMillionPlus !== undefined &&
    stepper?.selectedIndex > 0 &&
    ((isULBMillionPlus && stepper?.selectedIndex !== 4) ||
      (isULBMillionPlus === false && stepper.selectedIndex !== 3))
  "
>
  <strong>NOTE:</strong><br />
  1. All fields are mandatory<br />
  2. Only files with <strong>pdf</strong> extension are allowed. Other type of
  files will be filtered out.<br />
  3. Only 1 file can be selected per question.<br />
</p>

<ng-template #savingPopup>
  <mat-spinner style="margin: auto" *ngIf="draftSavingInProgess"></mat-spinner>
  <h2 class="text-center" *ngIf="draftSavingInProgess">Saving...</h2>

  <app-tick-icon
    class="tick"
    *ngIf="!draftSavingInProgess && !saveAsDraftFailMessge"
  ></app-tick-icon>
  <div class="d-flex justify-content-center" *ngIf="saveAsDraftFailMessge">
    <i
      class="fa fa-exclamation-circle"
      style="transform: scale(3.5); color: red"
      aria-hidden="true"
    ></i>
  </div>

  <h2 class="text-center" *ngIf="!draftSavingInProgess">
    {{ saveAsDraftFailMessge || successMessage }}
  </h2>
</ng-template>

<ng-template #previewPopup>
  <app-preview
    *ngIf="previewData"
    [data]="previewData"
    [isULBMillionPlus]="isULBMillionPlus"
  ></app-preview>
</ng-template>

<div *ngIf="isULBMillionPlus === undefined">
  <app-pre-loader></app-pre-loader><app-pre-loader></app-pre-loader
  ><app-pre-loader></app-pre-loader><app-pre-loader></app-pre-loader>
</div>
