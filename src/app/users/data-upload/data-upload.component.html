<ng-container *ngIf="id; else noId">
  <div class="row" style="margin-left: 2%">
    <div class="col mt-3"></div>
    <ng-container *ngIf="id === 'upload-form'">
      <app-financial-uploads [financialData]="uploadObject">
        <button
          *ngIf="uploadObject"
          (click)="location.back()"
          class="btn btn-primary btn-upload"
          style="transform: unset"
        >
          Back
        </button>
      </app-financial-uploads>
    </ng-container>
  </div>
</ng-container>

<ng-template class="" #noId>
  <div class="common-container">
    <div class="container">
      <div class="row">
        <div
          class="col-sm-12"
          *ngIf="
            !(
              userUtil.getUserType() == 'ULB' ||
              userUtil.getUserType() == 'STATE'
            )
          "
        >
          <!-- <app-financial-data-chart
            [financialYears]="financialYearDropdown"
          ></app-financial-data-chart> -->
        </div>
      </div>

      <!-- Cards -->
      <div class="card-container">
        <div class="card blue">
          <img src="../../../assets/images/card-icons/team.png" alt="Team" />
          <p class="heading">Total number of ULBs</p>
          <span class="card-main-value">
            {{ cardData?.totalULB?.sum }}
          </span>
          <hr />

          <div
            class="categories d-flex justify-content-evenly align-items-center"
          >
            <span class="category">
              <span class="category-heading">Corporation</span>
            </span>
            <span class="category">
              <span class="category-heading">Municipality</span>
            </span>
            <span class="category">
              <span class="category-heading"
                >Town <br />
                Punchayat</span
              >
            </span>
          </div>
          <div class="categories d-flex categories-values align-items-center">
            <span class="category">
              <span class="category-heading category-value">
                {{ cardData?.totalULB["Municipal Corporation"] }}
              </span>
            </span>
            <span class="category">
              <span class="category-heading category-value">{{
                cardData?.totalULB["Municipality"]
              }}</span>
            </span>
            <span class="category">
              <span class="category-heading category-value">
                {{ cardData?.totalULB["Town Panchayat"] }}
              </span>
            </span>
          </div>

          <div class="view-list" (click)="onclickTotalNoOfULB()">View List</div>
        </div>

        <div class="card pink">
          <img src="../../../assets/images/card-icons/team.png" alt="Team" />
          <p class="heading">No of ULBs Registered</p>
          <span class="card-main-value">
            {{ cardData?.registeredUlb?.sum }}
          </span>
          <hr />

          <div
            class="categories d-flex justify-content-evenly align-items-center"
          >
            <span class="category">
              <span class="category-heading">Corporation</span>
            </span>
            <span class="category">
              <span class="category-heading">Municipality</span>
            </span>
            <span class="category">
              <span class="category-heading"
                >Town <br />
                Punchayat</span
              >
            </span>
          </div>
          <div class="categories d-flex categories-values align-items-center">
            <span class="category">
              <span class="category-heading category-value">
                {{ cardData?.registeredUlb["Municipal Corporation"] }}</span
              >
            </span>
            <span class="category">
              <span class="category-heading category-value">
                {{ cardData?.registeredUlb["Municipality"] }}</span
              >
            </span>
            <span class="category">
              <span class="category-heading category-value">
                {{ cardData?.registeredUlb["Town Panchayat"] }}</span
              >
            </span>
          </div>

          <div class="view-list" (click)="onClickingOtherCards()">
            View List
          </div>
        </div>

        <div class="card green">
          <img src="../../../assets/images/card-icons/team.png" alt="Team" />
          <p class="heading">Million Plus Cities(Registered)</p>
          <span class="card-main-value">
            {{ cardData?.registeredMillionPlus?.sum }}
          </span>
          <hr />

          <div
            class="categories d-flex justify-content-evenly align-items-center"
          >
            <span class="category">
              <span class="category-heading">Corporation</span>
            </span>
            <span class="category">
              <span class="category-heading">Municipality</span>
            </span>
            <span class="category">
              <span class="category-heading"
                >Town <br />
                Punchayat</span
              >
            </span>
          </div>
          <div class="categories d-flex categories-values align-items-center">
            <span class="category">
              <span class="category-heading category-value">{{
                cardData?.registeredMillionPlus["Municipal Corporation"]
              }}</span>
            </span>
            <span class="category">
              <span class="category-heading category-value">{{
                cardData?.registeredMillionPlus["Municipality"]
              }}</span>
            </span>
            <span class="category">
              <span class="category-heading category-value">{{
                cardData?.registeredMillionPlus["Town Panchayat"]
              }}</span>
            </span>
          </div>

          <div
            class="view-list"
            (click)="
              onClickingOtherCards({ isMillionPlus: 'Yes', registered: 'Yes' })
            "
          >
            View List
          </div>
        </div>

        <div class="card yellow">
          <img src="../../../assets/images/card-icons/team.png" alt="Team" />
          <p class="heading">Non-Million Plus Cities(Registered)</p>
          <span class="card-main-value">
            {{ cardData?.registeredNonMillionPlus["sum"] }}
          </span>
          <hr />

          <div
            class="categories d-flex justify-content-evenly align-items-center"
          >
            <span class="category">
              <span class="category-heading">Corporation</span>
            </span>
            <span class="category">
              <span class="category-heading">Municipality</span>
            </span>
            <span class="category">
              <span class="category-heading"
                >Town <br />
                Punchayat</span
              >
            </span>
          </div>
          <div class="categories d-flex categories-values align-items-center">
            <span class="category">
              <span class="category-heading category-value">{{
                cardData?.registeredNonMillionPlus["Municipal Corporation"]
              }}</span>
            </span>
            <span class="category">
              <span class="category-heading category-value">{{
                cardData?.registeredNonMillionPlus["Municipality"]
              }}</span>
            </span>
            <span class="category">
              <span class="category-heading category-value">{{
                cardData?.registeredNonMillionPlus["Town Panchayat"]
              }}</span>
            </span>
          </div>

          <div
            class="view-list"
            (click)="
              onClickingOtherCards({ isMillionPlus: 'No', registered: 'Yes' })
            "
          >
            View List
          </div>
        </div>

        <div class="nested-card-container d-flex">
          <div class="card brown">
            <img src="../../../assets/images/card-icons/team.png" alt="Team" />
            <p class="heading">Million Plus Cities(Total)</p>
            <span class="card-main-value">
              {{ cardData?.totalMillionPlus["sum"] }}
            </span>
            <hr />

            <div
              class="categories d-flex justify-content-evenly align-items-center"
            >
              <span class="category">
                <span class="category-heading">Corporation</span>
              </span>
              <span class="category">
                <span class="category-heading">Municipality</span>
              </span>
              <span class="category">
                <span class="category-heading"
                  >Town <br />
                  Punchayat</span
                >
              </span>
            </div>
            <div class="categories d-flex categories-values align-items-center">
              <span class="category">
                <span class="category-heading category-value">{{
                  cardData?.totalMillionPlus["Municipal Corporation"]
                }}</span>
              </span>
              <span class="category">
                <span class="category-heading category-value">{{
                  cardData?.totalMillionPlus["Municipality"]
                }}</span>
              </span>
              <span class="category">
                <span class="category-heading category-value">{{
                  cardData?.totalMillionPlus["Town Panchayat"]
                }}</span>
              </span>
            </div>

            <div
              class="view-list"
              (click)="onClickingOtherCards({ isMillionPlus: 'Yes' })"
            >
              View List
            </div>
          </div>

          <div class="card dark-green" style="margin-bottom: 0px">
            <img src="../../../assets/images/card-icons/team.png" alt="Team" />
            <p class="heading">Non-Million Plus Cities(Total)</p>
            <span class="card-main-value">{{
              cardData?.totalNonMillionPlus["sum"]
            }}</span>
            <hr />

            <div
              class="categories d-flex justify-content-evenly align-items-center"
            >
              <span class="category">
                <span class="category-heading">Corporation</span>
              </span>
              <span class="category">
                <span class="category-heading">Municipality</span>
              </span>
              <span class="category">
                <span class="category-heading"
                  >Town <br />
                  Punchayat</span
                >
              </span>
            </div>
            <div class="categories d-flex categories-values align-items-center">
              <span class="category">
                <span class="category-heading category-value">{{
                  cardData?.totalMillionPlus["Municipal Corporation"]
                }}</span>
              </span>
              <span class="category">
                <span class="category-heading category-value">{{
                  cardData?.totalMillionPlus["Municipality"]
                }}</span>
              </span>
              <span class="category">
                <span class="category-heading category-value">{{
                  cardData?.totalMillionPlus["Town Panchayat"]
                }}</span>
              </span>
            </div>

            <div
              class="view-list"
              (click)="onClickingOtherCards({ isMillionPlus: 'No' })"
            >
              View List
            </div>
          </div>
        </div>

        <div class="chart-container">
          <p class="heading" style="font-size: 1.6rem">
            15<sup>th</sup> FC Form Data Upload Status
          </p>
          <canvas id="canvas" width="150" height="43"></canvas>
        </div>
      </div>

      <div class="ulb-list" id="ulb-list">
        <div class="col-md-12" style="padding-left: 0px">
          <h3>
            <span> ULB List </span>

            <button
              *ngIf="dataUploadList && dataUploadList.length"
              class="btn btn-primary"
              style="float: right; margin-right: 6px"
              (click)="downloadULBList()"
            >
              Download List
            </button>
          </h3>
        </div>

        <div class="col-sm-12" style="padding-left: 0px">
          <table
            aria-describedby="ULB Singup List"
            class="table upldate-table"
            *ngIf="ulbList; else loader"
          >
            <thead>
              <tr class="" style="color: white">
                <th scope="S.No" class="text-center">S.No.</th>
                <th scope="S.No" class="text-center">State Name</th>
                <th scope="S.No" class="text-center">ULB Name</th>
                <th scope="S.No" class="text-center">ULB Type</th>
                <th scope="S.No" class="text-center">Census Code</th>
                <th scope="S.No" class="text-center">Swatch Bharat Code</th>
                <th scope="S.No" class="text-center">Email Id</th>
                <th scope="S.No" class="text-center">Mobile Number</th>
                <th scope="S.No" class="text-center">Registered</th>
                <th scope="S.No" class="text-center">Type</th>
              </tr>
            </thead>
            <tbody>
              <tr [formGroup]="ulbFilter">
                <td></td>
                <td></td>
                <td>
                  <div class="input-group">
                    <input
                      formControlName="ulbName"
                      placeholder="ULB Name"
                      type="text"
                      class="form-control"
                    />
                  </div>
                </td>
                <td>
                  <div class="input-group">
                    <input
                      formControlName="ulbType"
                      placeholder="ULB Type"
                      type="text"
                      class="form-control"
                    />
                  </div>
                </td>
                <td>
                  <div class="input-group">
                    <input
                      formControlName="censusCode"
                      placeholder="Census Code"
                      type="text"
                      class="form-control"
                    />
                  </div>
                </td>
                <td>
                  <div class="input-group">
                    <input
                      formControlName="sbCode"
                      placeholder="Swatcha Bharat Code"
                      type="text"
                      class="form-control"
                    />
                  </div>
                </td>
                <td>
                  <div class="input-group">
                    <input
                      formControlName="email"
                      placeholder="Email Id"
                      type="text"
                      class="form-control"
                    />
                  </div>
                </td>
                <td>
                  <div class="input-group">
                    <input
                      formControlName="mobile"
                      placeholder="Mobile Number"
                      type="text"
                      class="form-control"
                    />
                  </div>
                </td>
                <td>
                  <div class="input-group">
                    <select
                      name="registered"
                      id="registered"
                      formControlName="registration"
                      class="form-control"
                      placeholder="Registered"
                    >
                      <option value="" selected>Both</option>
                      <option value="Yes">Yes</option>
                      <option value="No">No</option>
                    </select>
                  </div>
                </td>
                <td>
                  <div class="input-group">
                    <select
                      formControlName="isMillionPlus"
                      name="population"
                      id="population"
                      class="form-control"
                      placeholder="Population"
                    >
                      <option value="Both" selected>Both</option>
                      <option value="Yes">Million Plus</option>
                      <option value="No">Non Million</option>
                    </select>
                  </div>
                </td>
              </tr>
              <ng-container *ngIf="ulbList?.length; else noData">
                <tr
                  *ngFor="
                    let row of ulbList
                      | paginate
                        : {
                            id: 'ulblist-pagination',
                            itemsPerPage: ulbtableDefaultOptions.itemPerPage,
                            currentPage: ulbtableDefaultOptions.currentPage,
                            totalItems: ulbtableDefaultOptions.totalCount
                          };
                    index as i
                  "
                >
                  <td>{{ i + 1 }}</td>
                  <td>{{ row.stateName }}</td>
                  <td>{{ row.ulbName }}</td>

                  <td>{{ row.ulbType }}</td>
                  <td>{{ row.censusCode }}</td>
                  <td>{{ row.sbCode }}</td>
                  <td>{{ row.email }}</td>
                  <td>{{ row.mobile }}</td>
                  <td>{{ row.registration }}</td>
                  <td>
                    {{
                      row.isMillionPlus === "Yes"
                        ? "Million Plus Cities"
                        : "Non-Million Plus Cities"
                    }}
                  </td>
                </tr>
              </ng-container>
              <ng-template #noData>
                <tr>
                  <td class="text-center" [attr.colspan]="10">
                    <h3>No Data Available</h3>
                  </td>
                </tr>
              </ng-template>
            </tbody>
          </table>
          <pagination-controls
            *ngIf="ulbtableDefaultOptions.totalCount"
            style="float: right; position: relative"
            id="ulblist-pagination"
            (pageChange)="setulbPage($event)"
            directionLinks="true"
            autoHide="true"
            previousLabel="Previous"
            nextLabel="Next"
            screenReaderPaginationLabel="Pagination"
            screenReaderPageLabel="page"
            screenReaderCurrentLabel="You're on page"
          >
          </pagination-controls>
          <ng-template #loader>
            <div
              class="d-flex w-100 justify-content-center align-items-center"
              style="height: 70vh"
            >
              <mat-spinner></mat-spinner>
            </div>
          </ng-template>
        </div>
      </div>

      <div class="data-upload-container">
        <div class="col-md-12" style="padding-left: 0px">
          <h3>
            <span> ULB Data Upload Tracker </span>
            <button
              role="menuitem"
              *ngIf="
                isAccessible && (!dataUploadList || !dataUploadList.length)
              "
              [routerLink]="['/user/data-upload/upload-form']"
              class="btn btn-primary"
              style="border-radius: 5px; float: right; margin-right: 6px"
            >
              Upload Data
            </button>
            <button
              *ngIf="dataUploadList && dataUploadList.length"
              class="btn btn-primary"
              style="float: right; margin-right: 6px"
              (click)="downloadList()"
            >
              Download List
            </button>
          </h3>
        </div>

        <div class="col-sm-12" style="padding-left: 0px">
          <table
            aria-describedby="ULB Singup List"
            class="table upldate-table"
            *ngIf="!loading; else loader"
          >
            <thead>
              <tr class="" style="color: white">
                <th scope="S.No" class="text-center">S.No.</th>
                <th
                  scope=""
                  [ngClass]="header.id == 'action' ? 'text-center' : ''"
                  *ngFor="let header of tableHeaders"
                  [attr.width]="
                    header.width
                      ? header.width
                      : 100 / tableHeaders.length + '%'
                  "
                >
                  <ng-container [ngSwitch]="!!header.click">
                    <span
                      (click)="sortById(header.id)"
                      class="cursor-pointer"
                      *ngSwitchCase="true"
                    >
                      {{ header.title
                      }}<em class="glyphicon glyphicon-sort"></em
                    ></span>
                    <span *ngSwitchCase="false">{{ header.title }}</span>
                  </ng-container>
                </th>
              </tr>
            </thead>
            <tbody>
              <tr [formGroup]="fileFormGroup">
                <td></td>
                <td>
                  <div class="input-group">
                    <select
                      name="State"
                      id="state"
                      [formControl]="stateNameControl"
                      class="form-control"
                      placeholder="State"
                    >
                      <option value="" selected>All States</option>
                      <option
                        *ngFor="let state of stateList"
                        [value]="state.name"
                      >
                        {{ state.name }}
                      </option>
                    </select>
                  </div>
                </td>
                <td *ngIf="userUtil.getUserType() != 'ULB'">
                  <div class="input-group">
                    <input
                      placeholder="ULB Name"
                      type="text"
                      [formControl]="ulbNameSearchFormControl"
                      class="form-control"
                    />
                  </div>
                </td>

                <!-- <td *ngIf="userUtil.getUserType() != 'ULB'">
                  <div class="input-group">
                    <input
                      placeholder="ULB Code"
                      type="text"
                      [formControl]="ulbCodeSearchFormControl"
                      class="form-control"
                    />
                  </div>
                </td> -->
                <td>
                  <div class="input-group">
                    <input
                      placeholder="Census Code"
                      type="text"
                      [formControl]="censusCode"
                      class="form-control"
                    />
                  </div>
                </td>
                <td>
                  <div class="input-group">
                    <input
                      placeholder="Swatcha Bharat Code"
                      type="text"
                      [formControl]="sbCode"
                      class="form-control"
                    />
                  </div>
                </td>

                <td>
                  <div class="input-group">
                    <label for="uploadStatus"></label>
                    <select
                      id="uploadStatus"
                      class="form-control"
                      [formControl]="uploadStatusFormControl"
                    >
                      <option value="" selected>All Status</option>
                      <option
                        [value]="option.id"
                        *ngFor="let option of uploadCheckStatusDropDown"
                      >
                        {{ option?.itemName }}
                      </option>
                    </select>
                  </div>
                </td>
                <td>
                  <button
                    class="btn btn-primary m-auto d-block"
                    (click)="applyFilterClicked()"
                  >
                    Search
                  </button>
                </td>
              </tr>
              <ng-container *ngIf="dataUploadList.length; else noData">
                <tr
                  style="background: #e7e7e7; border-bottom: 5px solid white"
                  *ngFor="
                    let row of dataUploadList
                      | paginate
                        : {
                            id: 'upload-pagination',
                            itemsPerPage: tableDefaultOptions.itemPerPage,
                            currentPage: tableDefaultOptions.currentPage,
                            totalItems: tableDefaultOptions.totalCount
                          };
                    index as i
                  "
                >
                  <td class="text-center">
                    {{
                      (tableDefaultOptions?.currentPage - 1) *
                        tableDefaultOptions.itemPerPage +
                        (i + 1)
                    }}
                  </td>
                  <td
                    [ngClass]="header.id == 'action' ? 'text-center' : ''"
                    *ngFor="let header of tableHeaders"
                  >
                    <ng-container [ngSwitch]="header.id">
                      <ng-container *ngSwitchCase="'action'">
                        <ng-container [ngSwitch]="row.canTakeAction">
                          <ng-container *ngSwitchCase="true">
                            <a
                              class="btn btn-primary"
                              (click)="navigateTo(row)"
                              title="Edit"
                              [routerLink]="[
                                '/user/data-upload/upload-form',
                                row?._id
                              ]"
                              >Take {{ header.title }}
                            </a>
                          </ng-container>

                          <ng-container *ngSwitchCase="false">
                            <a
                              (click)="navigateTo(row)"
                              title="View"
                              [routerLink]="[
                                '/user/data-upload/upload-form',
                                row?._id
                              ]"
                            >
                              <i class="fa fa-eye" aria-hidden="true"></i>
                            </a>
                          </ng-container>
                        </ng-container>
                      </ng-container>
                      <span *ngSwitchCase="'audited'">
                        {{ row[header.id] ? "Audited" : "Unaudited" }}
                      </span>
                      <span *ngSwitchCase="'ulbName'">{{
                        row[header.id]
                      }}</span>
                      <ng-container *ngSwitchCase="'status'">
                        <a (click)="openModal(row, historyModal)">
                          {{ row.customStatusText }}
                        </a>
                      </ng-container>

                      <span *ngSwitchDefault>{{ row[header.id] }}</span>
                    </ng-container>
                  </td>
                </tr>
              </ng-container>
              <ng-template #noData>
                <tr>
                  <td
                    class="text-center"
                    [attr.colspan]="tableHeaders.length + 1"
                  >
                    <h3>No Data Available</h3>
                  </td>
                </tr>
              </ng-template>
            </tbody>
          </table>
          <pagination-controls
            *ngIf="tableDefaultOptions.totalCount"
            style="float: right; position: relative"
            id="upload-pagination"
            (pageChange)="setPage($event)"
            directionLinks="true"
            autoHide="true"
            previousLabel="Previous"
            nextLabel="Next"
            screenReaderPaginationLabel="Pagination"
            screenReaderPageLabel="page"
            screenReaderCurrentLabel="You're on page"
          >
          </pagination-controls>
          <ng-template #loader>
            <div
              class="d-flex w-100 justify-content-center align-items-center"
              style="height: 70vh"
            >
              <mat-spinner></mat-spinner>
            </div>
          </ng-template>
        </div>
      </div>
    </div>
  </div>
</ng-template>

<ng-template #historyModal>
  <div class="modal-body">
    <div
      style="margin-bottom: 0.5rem; display: flex; justify-content: flex-end"
    >
      <button
        style="min-width: min-content"
        (click)="modalService.hide(1)"
        class="btn btn-danger"
        title="Close"
        type="button"
        data-dismiss="modal"
        aria-label="Close"
      >
        <i class="fa fa-times" style="color: white"></i>
      </button>
    </div>
    <div class="modal-title">
      <h3>Tracking</h3>
    </div>
    <div
      *ngIf="modalTableData.length; else noData"
      class="table-responsive"
      style="max-height: 50vh; overflow-y: auto"
    >
      <table class="table tracking-history-table">
        <thead>
          <tr>
            <th style="position: sticky; top: 0" class="text-center"></th>
            <th style="position: sticky; top: 0" class="text-center">Sr. No</th>
            <th style="position: sticky; top: 0">Action</th>
            <th style="position: sticky; top: 0">Date</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let row of modalTableData; let i = index">
            <td class="text-center">
              <em
                *ngIf="
                  row['status'] == uploadStatus.APPROVED &&
                  row.actionTakenByUserRole === userTypes.MoHUA
                "
                class="fa fa-check-circle text-success"
              ></em>
            </td>
            <td class="text-center">{{ i + 1 }}</td>
            <td>{{ row.customStatusText }}</td>
            <td>
              {{ row["modifiedAt"] | date: "MMM d, y, h:mm a":"GMT" }}
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
  <ng-template #noData>
    <div class="row">
      <div class="col-sm-12">
        <h4 class="text-center">Nothing to show</h4>
      </div>
    </div>
  </ng-template>
</ng-template>

<ng-template #updateWithoutChangeWarning>
  <div>
    <p class="text-center">
      The following fields were rejected but you are updating without making any
      changes.
    </p>
    <ol *ngIf="Object.keys(rejectFields) as keys">
      <li *ngFor="let key of keys">{{ rejectFields[key] }}</li>
    </ol>
    <p class="text-center font-weight-bold">
      <strong>Are you sure you want to update?</strong>
    </p>
    <div class="d-flex justify-content-center">
      <button
        #updateButton
        class="btn btn-primary mr-1"
        (click)="_matDialog.closeAll() || updateClickHandler(updateButton)"
      >
        Yes
      </button>
      <button class="btn btn-primary ml-1" (click)="_matDialog.closeAll()">
        No
      </button>
    </div>
  </div>
</ng-template>
